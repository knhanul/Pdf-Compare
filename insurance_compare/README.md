# 가입설계서 비교 프로그램

가입설계서 PDF 파일을 비교하여 변경/추가/삭제된 내용을 시각적으로 표시하는 GUI 프로그램입니다.

## 주요 기능

### 1. 스마트 PDF 파싱
- **머릿글/바닥글 자동 제거**: Y좌표 기반으로 불필요한 헤더/푸터 제거
- **섹션 구조 인식**: ◆(큰 제목), ■(섹션 제목) 자동 감지
- **설명 텍스트 추출**: 섹션 제목과 같은 라인의 설명 텍스트 자동 그룹화

### 2. 단어 단위 비교
- **정확한 차이 감지**: 단어 단위로 추가/삭제/변경 사항 분석
- **스마트 매칭**: 유사도 기반 블록 매칭으로 구조 변경에도 대응
- **상세 정보 제공**: 변경된 단어 목록과 컨텍스트 제공

### 3. 시각적 비교 UI
- **양면 비교 뷰**: 템플릿과 생성본을 나란히 표시
- **색상 코딩**:
  - 🟡 **노란색**: 변경된 내용
  - 🔴 **빨간색**: 삭제된 내용
  - 🟢 **초록색**: 추가된 내용
- **인터랙티브 툴팁**: 마우스 오버 시 상세 변경 내용 표시
- **차이점 네비게이션**: 이전/다음 버튼으로 차이점 간 빠른 이동
- **동기화 스크롤**: 양쪽 문서 스크롤 자동 동기화

## 파일 구조

```
insurance_compare/
├── insurance_compare_gui.py    # 메인 GUI 프로그램
├── pdf_parser.py                # PDF 파싱 및 전처리 모듈
├── text_comparator.py           # 단어 단위 비교 알고리즘
├── test_comparison.py           # 테스트 스크립트
├── README.md                    # 이 파일
└── 샘플 PDF 파일들
```

## 설치 방법

### 필수 요구사항
- Python 3.11 이상
- PyQt6
- PyMuPDF (fitz)

### 설치 명령

```bash
pip install PyQt6 pymupdf
```

## 사용 방법

### GUI 프로그램 실행

```bash
cd insurance_compare
python insurance_compare_gui.py
```

### 사용 단계

1. **템플릿 파일 열기**: "템플릿 파일 열기 (원본)" 버튼 클릭하여 원본 PDF 선택
2. **생성본 파일 열기**: "생성본 파일 열기" 버튼 클릭하여 비교할 PDF 선택
3. **비교 시작**: "비교 시작" 버튼 클릭
4. **결과 확인**: 
   - 색상으로 표시된 차이점 확인
   - 마우스를 올려 상세 정보 확인
   - "이전/다음 차이점" 버튼으로 네비게이션

### 테스트 실행

```bash
python test_comparison.py
```

## 기술 상세

### PDF 파싱 알고리즘

1. **머릿글/바닥글 필터링**
   - Y좌표 < 85: 머릿글로 간주하여 제거
   - Y좌표 > 750: 바닥글로 간주하여 제거

2. **섹션 구조화**
   - ◆ 기호: 큰 제목 (major section)
   - ■ 기호: 섹션 제목 (minor section)
   - 같은 Y좌표(±5) 범위: 같은 라인으로 그룹화

3. **텍스트 블록 추출**
   - 페이지별 텍스트 블록 추출
   - 폰트 크기, 굵기 정보 보존
   - 섹션 컨텍스트 정보 유지

### 비교 알고리즘

1. **블록 매칭**
   - SequenceMatcher를 사용한 유사도 계산
   - 임계값: 0.6 (60% 이상 유사 시 매칭)
   - 섹션 타입 일치 시 가중치 부여

2. **단어 단위 Diff**
   - difflib.Differ를 사용한 단어 단위 비교
   - 추가(+), 삭제(-), 유지( ) 구분
   - 변경 사항 상세 정보 생성

3. **하이라이트 생성**
   - 페이지별 하이라이트 정보 생성
   - bbox 좌표를 사용한 정확한 위치 표시
   - 색상 코딩으로 변경 유형 구분

## 테스트 결과

샘플 파일 비교 결과:
- **총 차이점**: 1,327개
- **변경됨**: 204개
- **삭제됨**: 996개
- **추가됨**: 127개

템플릿 파일(원본)에는 많은 플레이스홀더(○○○, xxx 등)가 있고, 생성본에는 실제 값으로 채워진 것을 정확히 감지했습니다.

## 주요 특징

### 1. 머릿글/바닥글 제거
기존 프로그램과 달리, 가입설계서 특성에 맞게 머릿글과 바닥글을 자동으로 제거하여 본문 내용만 비교합니다.

### 2. 섹션 구조 인식
◆와 ■ 기호를 인식하여 문서의 계층 구조를 파악하고, 같은 섹션끼리 비교합니다.

### 3. 설명 텍스트 처리
섹션 제목(■) 옆에 같은 라인으로 시작되는 설명 텍스트를 자동으로 그룹화하여 처리합니다.

### 4. 단어 단위 비교
기존의 줄 단위 비교가 아닌 단어 단위로 비교하여 더 세밀한 차이를 감지합니다.

### 5. 전체/섹션별 비교
- 전체 비교: 모든 내용 비교 (현재 구현)
- 섹션별 비교: 특정 섹션만 선택하여 비교 (UI 준비됨, 향후 확장 가능)

## 향후 개선 사항

1. **섹션별 선택 비교**: 특정 섹션만 선택하여 비교하는 기능
2. **비교 결과 내보내기**: Excel, HTML 등으로 비교 결과 저장
3. **플레이스홀더 감지 개선**: 가입설계서 특유의 플레이스홀더 패턴 자동 인식
4. **표 구조 인식**: 표 형태의 데이터를 구조적으로 비교
5. **변경 이력 추적**: 여러 버전 간 변경 이력 추적

## 라이선스

이 프로그램은 샘플 프로그램을 참고하여 가입설계서 비교에 특화되도록 개발되었습니다.

## 문의

문제가 발생하거나 개선 사항이 있으면 이슈를 등록해주세요.
